{% extends "admin/base.html" %}

{% block title %}تقویم رزروها{% endblock %}
{% block page_title %}تقویم رزروها{% endblock %}

{% block breadcrumb %}
{{ block.super }}
<li class="breadcrumb-item active">تقویم رزروها</li>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5>تقویم رزروها</h5>
        <div class="btn-group">
            <button class="btn btn-outline-secondary" id="prev-month">
                <i class="fas fa-chevron-right"></i> ماه قبل
            </button>
            <button class="btn btn-outline-primary" disabled id="current-month">
                {{ current_month|date:"F Y" }}
            </button>
            <button class="btn btn-outline-secondary" id="next-month">
                ماه بعد <i class="fas fa-chevron-left"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        <div id="booking-calendar"></div>
    </div>
</div>

<style>
    #booking-calendar {
        min-height: 600px;
    }
    .fc-event {
        cursor: pointer;
    }
    .fc-event.confirmed {
        background-color: #7366ff;
        border-color: #7366ff;
    }
    .fc-event.pending {
        background-color: #f8d62b;
        border-color: #f8d62b;
        color: #000;
    }
    .fc-event.cancelled {
        background-color: #dc3545;
        border-color: #dc3545;
    }
</style>

{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Initialize calendar
        var calendarEl = document.getElementById('booking-calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            locale: 'fa',
            direction: 'rtl',
            initialView: 'dayGridMonth',
            headerToolbar: false,
            events: [
                {% for booking in bookings %}
                {
                    id: '{{ booking.id }}',
                    title: 'اتاق {{ booking.room.number }} - {{ booking.guest.name }}',
                    start: '{{ booking.check_in|date:"Y-m-d" }}',
                    end: '{{ booking.check_out|date:"Y-m-d" }}',
                    className: '{{ booking.status }}',
                    url: '{% url 'accounts:dashboard' %}'
                },
                {% endfor %}
            ],
            eventClick: function(info) {
                window.location.href = info.event.url;
            }
        });
        calendar.render();

        // Month navigation
        $('#prev-month').click(function() {
            calendar.prev();
            updateMonthDisplay();
        });

        $('#next-month').click(function() {
            calendar.next();
            updateMonthDisplay();
        });

        function updateMonthDisplay() {
            var date = calendar.getDate();
            var month = date.toLocaleString('fa-IR', { month: 'long', year: 'numeric' });
            $('#current-month').text(month);
        }
    });
</script>
{% endblock %}